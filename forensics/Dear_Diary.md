## Dear Diary

Challenge description:
```
If you can find the flag on this disk image, we can close the case for good!
Download the disk image here.
```

Hints:
```
If you're observing binary data raw in the terminal you may be misled about the contents of a block.
```

The link to the disk image file:
```
https://artifacts.picoctf.net/c_titan/63/disk.flag.img.gz
```

first the type of the file is analysed:
```
file disk.flag.img.gz
```

Output:
```
disk.flag.img.gz: gzip compressed data, was "disk.flag.img", last modified: Sat Feb 17 22:59:04 2024, from Unix, original size modulo 2^32 1073741824
```

Thus this gzip file needs to be decompressed using:
```
gzip -d disk.flag.img.gz
```

Then information is found about the unzipped file:
```
file disk.flag.img
```

Output:
```
disk.flag.img: DOS/MBR boot sector; partition 1 : ID=0x83, active, start-CHS (0x0,32,33), end-CHS (0x26,94,56), startsector 2048, 614400 sectors; partition 2 : ID=0x82, start-CHS (0x26,94,57), end-CHS (0x47,1,58), startsector 616448, 524288 sectors; partition 3 : ID=0x83, start-CHS (0x47,1,59), end-CHS (0x82,138,8), startsector 1140736, 956416 sectors
```

Thus the file has 3 paritions. Partititon 2 is a swap partition. On research, it was found that there are portions on hard disk to temporarily store and retrieve data when RAM is full.

Thus for this chaallenge, we focus on partition 1 and 3.

The sleuth kit is installed.

```mmls```
is used to display partition layout.

```
mmls disk.flag.img
```

Output:
```
DOS Partition Table
Offset Sector: 0
Units are in 512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
001:  -------   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0000616447   0000614400   Linux (0x83)
003:  000:001   0000616448   0001140735   0000524288   Linux Swap / Solaris x86 (0x82)
004:  000:002   0001140736   0002097151   0000956416   Linux (0x83)
```
To list files of offset value we use:
```
fls -o 2048 disk.flag.img
```
This displays files in partition 1:
```
d/d 11: lost+found
r/r 13: ldlinux.sys
r/r 14: ldlinux.c32
r/r 16: config-virt
r/r 17: vmlinuz-virt
r/r 18: initramfs-virt
l/l 19: boot
r/r 21: libutil.c32
r/r 20: extlinux.conf
r/r 22: libcom32.c32
r/r 23: mboot.c32
r/r 24: menu.c32
r/r 15: System.map-virt
r/r 25: vesamenu.c32
V/V 76913:      $OrphanFiles
```

For partition 3:
```
fls -o 0001140736 disk.flag.img
```

Output:
```
d/d 32513:      home
d/d 11: lost+found
d/d 32385:      boot
d/d 64769:      etc
d/d 32386:      proc
d/d 13: dev
d/d 32387:      tmp
d/d 14: lib
d/d 32388:      var
d/d 21: usr
d/d 32393:      bin
d/d 32395:      sbin
d/d 32539:      media
d/d 203:        mnt
d/d 32543:      opt
d/d 204:        root
d/d 32544:      run
d/d 205:        srv
d/d 32545:      sys
d/d 32530:      swap
V/V 119417:     $OrphanFiles
```
We delve into root in partition 3:
```
fls -o 0001140736 disk.flag.img 204
```

Output:
```
r/r 1837:       .ash_history
d/d 1842:       secret-secrets
```

We explore the ```secret-secrets``` folder:
```
fls -o 0001140736 disk.flag.img 1842
```
Output:
```
r/r 1843:       force-wait.sh
r/r 1844:       innocuous-file.txt
r/r 1845:       its-all-in-the-name
```
We now try to explore the strings in the partition. On research it was found that 8 sectors is a convention for exploring.

```
icat -icat -o 0001140736  disk.flag.img 8 | strings 
```
It is a long output of strings.

We search for ".txt" files and display them in hex format:
```
icat -o 0001140736 disk.flag.img 8| xxd | grep ".txt"
```

Output:
```
001f8840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
001fbc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
001fdc40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
001ff440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00201840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00203c40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00206040: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00207840: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00209c40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
0020b440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
0020d840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
0020fc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00211440: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
```

We display 7 characters (an arbitrary number chosen) to display 7 lines after each match:
```
 icat -o 0001140736 disk.flag.img 8| xxd | grep ".txt" -A7
```

Output:
```
001f8840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
001f8850: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f8860: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f8870: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f8880: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f8890: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f88a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001f88b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
001fbc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
001fbc50: a803 1101 6f72 6967 696e 616c 2d66 696c  ....original-fil
001fbc60: 656e 616d 6500 0000 0000 0000 0000 0000  ename...........
001fbc70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fbc80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fbc90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fbca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fbcb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
001fdc40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
001fdc50: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fdc60: 0000 0000 0000 0000 3507 0000 8c03 0301  ........5.......
001fdc70: 7069 6300 0000 0000 0000 0000 0000 0000  pic.............
001fdc80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fdc90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fdca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001fdcb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
001ff440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
001ff450: a803 0301 6f43 5400 0000 0000 0000 0000  ....oCT.........
001ff460: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001ff470: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001ff480: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001ff490: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001ff4a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
001ff4b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00201840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00201850: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......
00201860: 467b 3100 0000 0000 0000 0000 0000 0000  F{1.............
00201870: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00201880: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00201890: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002018a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002018b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00203c40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00203c50: a803 0301 5f35 3300 0000 0000 0000 0000  ...._53.........
00203c60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00203c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00203c80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00203c90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00203ca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00203cb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00206040: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00206050: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......
00206060: 335f 6e00 0000 0000 0000 0000 0000 0000  3_n.............
00206070: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00206080: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00206090: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002060a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002060b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00207840: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
00207850: a803 0301 346d 3300 0000 0000 0000 0000  ....4m3.........
00207860: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00207870: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00207880: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00207890: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002078a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002078b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00209c40: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00209c50: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......
00209c60: 355f 3800 0000 0000 0000 0000 0000 0000  5_8.............
00209c70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00209c80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00209c90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00209ca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00209cb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
0020b440: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
0020b450: a803 0301 3064 3200 0000 0000 0000 0000  ....0d2.........
0020b460: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020b470: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020b480: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020b490: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020b4a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020b4b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
0020d840: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
0020d850: 0000 0000 0000 0000 3507 0000 9c03 0301  ........5.......
0020d860: 3462 3300 0000 0000 0000 0000 0000 0000  4b3.............
0020d870: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020d880: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020d890: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020d8a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020d8b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
0020fc40: 732d 6669 6c65 2e74 7874 0000 3507 0000  s-file.txt..5...
0020fc50: a803 0201 307d 0000 0000 0000 0000 0000  ....0}..........
0020fc60: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020fc70: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020fc80: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020fc90: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020fca0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
0020fcb0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
--
00211440: 732d 6669 6c65 2e74 7874 0000 0000 0000  s-file.txt......
00211450: 0000 0000 0000 0000 3507 0000 9c03 1301  ........5.......
00211460: 6974 732d 616c 6c2d 696e 2d74 6865 2d6e  its-all-in-the-n
00211470: 616d 6500 0000 0000 0000 0000 0000 0000  ame.............
00211480: 0000 0000 0000 0000 0000 0000 0000 0000  ................
00211490: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002114a0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
002114b0: 0000 0000 0000 0000 0000 0000 0000 0000  ................
```


The pieces of the flag are seen in the output:
```
picoCTF{1_533_n4m35_80d24b30}
```

